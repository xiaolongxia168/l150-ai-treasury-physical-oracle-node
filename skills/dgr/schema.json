{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://example.org/dgr.schema.json",
  "title": "DGR Artifact",
  "type": "object",
  "additionalProperties": false,
  "required": [
    "meta",
    "input",
    "assumptions",
    "risks",
    "recommendation",
    "consistency_check"
  ],
  "properties": {
    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "artifact_id",
        "spec_version",
        "created_at",
        "mode"
      ],
      "properties": {
        "artifact_id": {
          "type": "string",
          "minLength": 8,
          "description": "UUID v4 recommended"
        },
        "spec_version": {
          "type": "string",
          "const": "1.0.0"
        },
        "created_at": {
          "type": "string",
          "format": "date-time"
        },
        "mode": {
          "type": "string",
          "enum": [
            "dgr_min",
            "dgr_full",
            "dgr_strict"
          ]
        },
        "model": {
          "type": "string"
        },
        "task_class": {
          "type": "string"
        },
        "source_ref": {
          "type": "string"
        }
      }
    },
    "input": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "query_hash",
        "query_summary"
      ],
      "properties": {
        "query_hash": {
          "type": "string",
          "minLength": 8
        },
        "query_summary": {
          "type": "string",
          "maxLength": 500
        }
      }
    },
    "clarifications": {
      "type": "array",
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "question",
          "why_needed",
          "blocking"
        ],
        "properties": {
          "question": {
            "type": "string",
            "minLength": 3
          },
          "why_needed": {
            "type": "string",
            "minLength": 3
          },
          "blocking": {
            "type": "boolean"
          }
        }
      },
      "default": []
    },
    "decomposition": {
      "type": "array",
      "items": {
        "type": "string"
      },
      "default": []
    },
    "assumptions": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "statement",
          "impact_if_wrong"
        ],
        "properties": {
          "statement": {
            "type": "string",
            "minLength": 3
          },
          "impact_if_wrong": {
            "type": "string",
            "minLength": 3
          }
        }
      }
    },
    "risks": {
      "type": "array",
      "minItems": 1,
      "items": {
        "type": "object",
        "additionalProperties": false,
        "required": [
          "risk",
          "severity",
          "mitigation"
        ],
        "properties": {
          "risk": {
            "type": "string",
            "minLength": 3
          },
          "severity": {
            "type": "string",
            "enum": [
              "low",
              "medium",
              "high"
            ]
          },
          "mitigation": {
            "type": "string",
            "minLength": 3
          }
        }
      }
    },
    "recommendation": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "action",
        "rationale",
        "confidence",
        "review_required",
        "next_steps"
      ],
      "properties": {
        "action": {
          "type": "string",
          "minLength": 3
        },
        "rationale": {
          "type": "string",
          "minLength": 3
        },
        "confidence": {
          "type": "number",
          "minimum": 0,
          "maximum": 1
        },
        "review_required": {
          "type": "boolean"
        },
        "next_steps": {
          "type": "array",
          "items": {
            "type": "string"
          },
          "minItems": 0
        }
      }
    },
    "consistency_check": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "checks",
        "passed",
        "notes"
      ],
      "properties": {
        "checks": {
          "type": "array",
          "items": {
            "type": "string"
          }
        },
        "passed": {
          "type": "boolean"
        },
        "notes": {
          "type": "string"
        }
      }
    }
  }
}